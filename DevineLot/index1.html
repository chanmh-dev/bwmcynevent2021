<!doctype html>
<html lang="en">
  <head>
<head>
  <title>Bootstrap Example</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>


<style>
.imageBanner {
    display: block;
    position: relative;
    margin: 0 auto;
    width:100%;
    max-width: 512px;
}

#item {
  width: 50%;
  display: block;
  position: absolute;
  left: 0;
  top: 60%;
   z-index: 3;
}

.imageCentre {
  width: 100%;
  display: block;
  position: relative;
  z-index: 1;
  margin: 0 auto;
}

.qian {
  width: 30%;
  display: none;
  position: absolute;
  left: 11%;
  //top: 550px;
  top: 65%;
  z-index:2;
  -webkit-animation: floatQian 4s;
  animation: floatQian 4s;
  animation-fill-mode: forwards; 
}


@-webkit-keyframes floatQian {
    0% {
        top:65%;
    }
    100% {
        top: 50%;
    }
}
@keyframes floatQian {
    0% {
        top:65%;
    }
    100% {
        top: 50%;
    }
}


img {
    width: 100%;
}

</style>

</head>
<body>

<div class="imageBanner">
   <div class="imageLeft">
	  <img src="qtong-small.png" id="item">
   </div>
   <div class="imageCentre">
	  <img src="GuanYin.jpg">
   </div>
   <div class="qian-container" >
	  <img src="qian1.png" id="qian1" class="qian">
	  <img src="qian2.png" id="qian2" class="qian">
	  <img src="qian3.png" id="qian3" class="qian">
	  <img src="qian4.png" id="qian4" class="qian">
	  <img src="qian5.png" id="qian5" class="qian">
	  <img src="qian6.png" id="qian6" class="qian">
	  <img src="qian7.png" id="qian7" class="qian">
	  <img src="qian8.png" id="qian8" class="qian">
	  <img src="qian9.png" id="qian9" class="qian">
	  <img src="qian10.png" id="qian10" class="qian">
   </div>
</div>

<script>
    var random_num = Math.floor((Math.random() * 10) + 1);
	var qian = "qian";	
	var qianChosen  = "";	
    var dragItem = document.querySelector("#item");
    //var container = document.querySelector("#container");

    var active = false;
    var currentX;
    var currentY;
    var initialX;
    var initialY;
    var xOffset = 0;
    var yOffset = 0;
	var y_limit = 450;
	
	var env = findBootstrapEnvironment();
	if (env === "xs"){
		y_limit = 310;
	}
	

    item.addEventListener("touchstart", dragStart, false);
    item.addEventListener("touchend", dragEnd, false);
    item.addEventListener("touchmove", drag, false);

    item.addEventListener("mousedown", dragStart, false);
    item.addEventListener("mouseup", dragEnd, false);
    item.addEventListener("mousemove", drag, false);
	
	console.log(findBootstrapEnvironment());
	console.log(getViewport());

    function dragStart(e) {
	 console.log("touchstart")
	 document.getElementById(qian+random_num).style.display = "none";
	  reset1();
      if (e.type === "touchstart") {
        initialX = e.touches[0].clientX - xOffset;
        initialY = e.touches[0].clientY - yOffset;
      } else {
        initialX = e.clientX - xOffset;
        initialY = e.clientY - yOffset;
      }

      if (e.target === dragItem) {
        active = true;
      }
    }

    function dragEnd(e) {
	  random_num = Math.floor((Math.random() * 10) + 1);
	  document.getElementById(qian+random_num).style.display = "block";
      initialX = 0;//currentX;
      initialY = 0;//currentY;
	  
	  xOffset = 0;
	  yOffset = 0;
	  
	  setTranslate(0, 0, dragItem);

      active = false;
	 // timer();
	  console.log("drag ends")
	  console.log("x", currentX)
	  console.log("y", currentY)
    }

    function drag(e) {
      if (active) {
      
        e.preventDefault();
      
        if (e.type === "touchmove") {
          currentX = e.touches[0].clientX - initialX;
          currentY = e.touches[0].clientY - initialY;
        } else {
          currentX = e.clientX - initialX;
          currentY = e.clientY - initialY;
        }

        xOffset = currentX;
        yOffset = currentY;

        setTranslate(currentX, currentY, dragItem);
      }
    }

    function setTranslate(xPos, yPos, el) {
      el.style.transform = "translate3d(" + xPos + "px, " + yPos + "px, 0)";
    }
	
	//////////////////////
	function start(){
		document.getElementById(qian+random_num).style.display = "none";
		random_num = Math.floor((Math.random() * 10) + 1);
		document.getElementById(qian+random_num).style.display = "inline";
		timer();
	}	
		
	function reset1(){

	console.log("reset");
	if (typeof my_time !== 'undefined'){
		clearTimeout(my_time);
	}

	console.log(qianChosen);
	qianChosen = qian + random_num;
	console.log(qianChosen);
	console.log("random number",  random_num);
	document.getElementById(qianChosen).style.left= "11%";
	document.getElementById(qianChosen).style.top= "65%";
	var y=document.getElementById(qianChosen).offsetTop;
	var x=document.getElementById(qianChosen).offsetLeft;
	//document.getElementById("msg").innerHTML="X: " + x  + " Y : " + y

	}
	
	function disp(){
		var step=1; // Change this step value

		var y=document.getElementById(qian+random_num).offsetTop ;
		var x=document.getElementById(qian+random_num).offsetLeft;
		//console.log('y_disp', y);
        console.log(y_limit);
		if(y >= y_limit ){
			dir = 'up';
			y = y - step;
			//console.log('y1', y);
			
			document.getElementById(qian+random_num).style.top= y + "px"; // vertical movment
		}
	}
	
	function timer(){
		disp();
		var y=document.getElementById(qian+random_num).offsetTop ;
		var x=document.getElementById(qian+random_num).offsetLeft;
		//console.log('x', x);
		//console.log('y_timer', y);
		//document.getElementById("msg").innerHTML="X: " + x  + " Y : " + y;
		
		my_time=setTimeout('timer()',10);
	}
	
	function findBootstrapEnvironment() {
		let envs = ['xs', 'sm', 'md', 'lg', 'xl'];

		let el = document.createElement('div');
		document.body.appendChild(el);

		let curEnv = envs.shift();

		for (let env of envs.reverse()) {
			el.classList.add(`d-${env}-none`);

			if (window.getComputedStyle(el).display === 'none') {
				curEnv = env;
				break;
			}
		}

		document.body.removeChild(el);
		return curEnv;
	}
	
	function getViewport () {
	  // https://stackoverflow.com/a/8876069
	  const width = Math.max(
		document.documentElement.clientWidth,
		window.innerWidth || 0
	  )
	  
	  const height = Math.max(
		document.documentElement.clientHeight,
		window.innerHeight || 0
	  )
	  console.log(height);
	  
	  if (height <= 568){
		y_limit = 270;
	  }
	  
	  if (height >= 569 && height <= 640){
		y_limit = 290;
	  }
	  
	  if (height >= 641 && height <= 653){
		y_limit = 240;
	  }
	  
	  if (height >= 654 && height <= 667){
		y_limit = 320;
	  }
	  
	  if (height >= 668 && height <= 720){
		y_limit = 420;
	  }
	  
	  if (height >= 721 && height <= 731){
		y_limit = 350;
	  }
	  
	  if (height >= 732 && height <= 736){
		y_limit = 355;
	  }	
	  
	  if (height >= 737 && height <= 757){
		y_limit = 415;
	  }	
	  
	  if (height >= 758 && height <= 812){
		y_limit = 310;
	  }	  
	  
	  if (height >= 813 && height <= 823){
		y_limit = 350;
	  }
	  
	  if (width <= 576) return 'xs'
	  if (width <= 768) return 'sm'
	  if (width <= 992) return 'md'
	  if (width <= 1200) return 'lg'
	  return 'xl'
	}

</script>

</body>
</html>
